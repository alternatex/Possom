<html>
	<head>
             <meta name="decorator" content="maindecorator">
	</head>

    <body>

        <content tag="companies-results">
            #set ($company = $result.getCompaniesResults())
            #set ($env = $coordHelper.getEnvelope($company))
            #set ($zoomlevel = $coordHelper.getZoomLevel($env))
            #set ($zoomscale = $coordHelper.getZoomScale($env))
            #set ($mappoints = $coordHelper.getMapPoints($company, $env))
            #set ($zoomLevels = $coordHelper.getZoomLevels())            

            <SCRIPT TYPE='text/javascript' LANGUAGE='JavaScript' SRC='../javascript/map.js'></SCRIPT>
            <SCRIPT TYPE='text/javascript' LANGUAGE='JavaScript' SRC='../javascript/mapicon.js'></SCRIPT>
            <SCRIPT TYPE='text/javascript' LANGUAGE='JavaScript' SRC='../javascript/layers.js'></SCRIPT>

            <script type="text/javascript" language="JavaScript">      
                    var arrZoomLevels = new Array();
                    var arrCompany = new Array();   

                    #foreach ($level in $zoomLevels)
                        #set ($index = $velocityCount - 1)
                        arrZoomLevels[$index] = $level;
                    #end
                    currentZoomScale = arrZoomLevels[currentZoomLevel-1]; 
                    #foreach ($item in $result.getCompaniesResults())
                        arrCompany[$velocityCount - 1] = new coordObj($item.x, $item.y, $item.companyId);
                    #end   
        
                    var countZoomLevels = $coordHelper.getZoomCount();                     
                    ##variable som hentes fra noen konfigurasjon   
                    var imgHeigth = $coordHelper.getImgHeigth();
                    var imgWidth = $coordHelper.getImgWidth();
                    var iconHeigth = $coordHelper.getIconPxSizeHeigth();
                    var iconWidth = $coordHelper.getIconPxSizeWidth();
                    var iconOffsetHeigth = $coordHelper.getIconOffsetHeigth();
                    var iconOffsetWidth = $coordHelper.getIconOffsetWidth();
                    var envFactor = $coordHelper.getEnvFactor();
                    var panfactor = $coordHelper.getPanFactor();
                    var zoomfactor = $coordHelper.getZoomFactor();
                    var imgMeterSize = $coordHelper.getImgMeterSize();//størrelse på kartbilde i meter                

                    ##current variable                    
                    var currentZoomLevel = $zoomlevel;          
                    var prevZoomLevel = currentZoomLevel;//initielt
                    var currentZoomScale = $zoomscale;
                    var maxX = $env.maxX;
                    var minX = $env.minX;
                    var maxY = $env.maxY;
                    var minY = $env.minY;
                    var centerCoordX = $env.getCenterX();
                    var centerCoordY = $env.getCenterY();
                    var centerPixY = imgHeigth/2;
                    var centerPixX = imgWidth/2;
                    var dX = maxX - minX;
                    var dY = maxY - minY;  
                    ##var prevMaxX = maxX;
                    ##var prevMinX = minX;
                    ##var prevMaxY = maxY;
                    ##var prevMinY = minY;
                    var contextPath = "$contextPath";
                    
                    //zoom box
                    content = '<img name="zoomImageTop" src="../images/mapicon/pixel.gif" width=1 height=1>';
                    createLayer("zoomBoxTop",xMapOffset,yMapOffset,"100%","100%",false,content);
                    content = '<img name="zoomImageLeft" src="../images/mapicon/pixel.gif" width=1 height=1>';
                    createLayer("zoomBoxLeft",xMapOffset,yMapOffset,"100%","100%",false,content);
                    content = '<img name="zoomImageRight" src="../images/mapicon/pixel.gif" width=1 height=1>';
                    createLayer("zoomBoxRight",xMapOffset,yMapOffset,"100%","100%",false,content);
                    content = '<img name="zoomImageBottom" src="../images/mapicon/pixel.gif" width=1 height=1>';
                    createLayer("zoomBoxBottom",xMapOffset,yMapOffset,"100%","100%",false,content);
                    
                    function init(){         
                        //adjustIcons("false");                        
                        //initializeEvents();
                        setImgMapOffset(document.getElementById("mapcontent"));
                        getUrl();
                        setZoomBarImg(currentZoomLevel)
                    }                 
   
            </script>

            #if ($result.getTotalDocumentsAvailable() > 0)

                #if ($result.getModifier())
                    #set ($baseURL = "?c=y&amp;q=$result.getQuery()&amp;mod=$result.getModifier()")
                #else
                    #set ($baseURL = "?c=y&amp;q=$result.getQuery()")
                #end
                <table id="company_result" class="page_margin_left">
                    <tr>
                        <td colspan="3">
                            <h1 class="search_query_h1">Du har søkt på $result.getQuery()</h1>
                        </td>
                    </tr>
                    <tr>
                        <td valign="top">
                            <table class="nav" cellspacing="0" cellpadding="0">
                                <tr>
                                     <td colspan="2"><div class="header">Treff i bransjer</div></td>
                                </tr>
                                #foreach ($category in $result.getCategoryModifiers())
                                    #if ($velocityCount <= 6)
                                        <tr>
                                            #if ($velocityCount == 1)
                                                <td class="first_col1"><a href="$baseURL&amp;mod=$category.name">$category.name</a></td>
                                                <td class="first_col2">$category.count</td>
                                            #else
                                                <td class="col1"><a href="$baseURL&amp;mod=$category.name">$category.name</a></td>
                                                <td class="col2">$category.count</td>
                                            #end
                                        </tr>
                                    #end
                                #end
                            </table>

                            <table id="geo_nav" class="nav" cellspacing="0" cellpadding="0">
                                <tr>
                                     <td colspan="2"><div class="header">Velg område</div></td>
                                </tr>
                                <tr>
                                    <td class="col1">Alna</a></td>
                                    <td class="col2">452</td>
                                </tr>
                                <tr>
                                    <td class="col1">Østensjø</a></td>
                                    <td class="col2">333</td>
                                </tr>
                                <tr>
                                    <td class="col1">Nordstrand</a></td>
                                    <td class="col2">252</td>
                                </tr>
                                <tr>
                                    <td class="col1">Frogner</a></td>
                                    <td class="col2">45</td>
                                </tr>
                            </table>
                        </td>

                        <td valign="top">
                            <table id="result_table" width="420px" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td><div class="result_header1">Viser $result.getPager().getFirstHitOnPage() - #if ($result.getTotalDocumentsAvailable() < $result.getPager().getLastHitOnPage()) $result.getTotalDocumentsAvailable() #else $result.getPager().getLastHitOnPage() #end av $result.getTotalDocumentsAvailable() på $result.getQuery()</div></td>
                                    <td><div class="result_header2">#if ($result.getPager().getNumberOfPages() > 1)<a href="$baseURL&amp;offset=$result.getPager().getOffsetOfNextPage()"><b>10 neste treff</b></a>#end</div></td>
                                </tr>
                                #foreach ($item in $result.getCompaniesResults())
                                    <tr>
                                        <td class="line1_col1" colspan="2"><b>$item.companyName</b><a href="$baseURL&amp;companyId=$item.companyId">Infoside</a></td>
                                    </tr>
                                    <tr>
                                        <td class="line2_col1">$!{item.visitingAddress}#if ($item.visitingAddress && ($item.visitingZip || $item.visitingCity)),#end $!{item.visitingZip} $!{item.visitingCity}</td>
                                        <td class="line2_col2">#if ($item.anyPhoneNumber) $item.anyPhoneNumber #else &nbsp; #end</td>
                                    </tr>
                                #end
                            </table>
                        </td>

                        ## ---------------- kart del -------------------
                        <td valign="top" width="379" >
                            <table bgcolor="#eff0f4" border="0" cellspacing="0" cellpadding="0" width="379">
                    		<tr>
                                    <td width="8px" height="8px"><a href="javascript:pan('nw');"><img src="../images/mapicon/panNW.jpg" width="8px" height="8px" alt="panorer"/></a></td>
                                    <td align="center" height="8px" width="$coordHelper.getImgWidth()px"><a href="javascript:pan('n');"><img src="../images/mapicon/panN.jpg" height="8px" alt="panorer"/></a></td>
                                    <td width="8px" height="8px"><a href="javascript:pan('ne');"><img src="../images/mapicon/panNE.jpg" width="8px" height="8px" alt="panorer"/></a></td>
                    		</tr>
                    		<tr>
                                    <td width="8px"><a href="javascript:pan('w');"><img src="../images/mapicon/panW.jpg" width="8px" alt="panorer"/></a></td>
                                    <td width="$coordHelper.getImgWidth()px" height="$coordHelper.getImgHeigth()px" valign="top"> 
                                        <div id="mapcontent" style="POSITION: absolute; OVERFLOW: hidden; WIDTH: $coordHelper.getImgWidth()px; HEIGTH: $coordHelper.getImgHeigth()px;"> 
                                             <img name="map" src="../images/mapicon/loading.gif" width="$coordHelper.getImgWidth()px" height="$coordHelper.getImgHeigth()px" border="0" alt="kart" style="z-index: 1"/>
                                                #foreach ($item in $result.getCompaniesResults())                                                    
                                                    #set ($index = $velocityCount - 1)
                                                    #set ($mappoint = $mappoints.get($index))  
                                                    #if($mappoint.x == $coordHelper.getDefaultNoCoord()) ## dersom det ikke finnes koordinater for bedriften vises ikke bilde                                                        
                                                        <img src="../images/mapicon/ballong.gif" border="0" id="icon_$item.companyId" onmouseover="return setImage('info', 'highlite', this.name);" onmouseout="return setImage('info', 'normal', this.name);" alt="$item.getCompanyName()" onclick="location.href='$baseURL&amp;companyId=$item.companyId'" style="POSITION: absolute;TOP: 0px;LEFT: 0px; Z-INDEX: 100; CURSOR: pointer; VISIBILITY: hidden"/>                                                
                                                    #else
                                                        <img src="../images/mapicon/ballong.gif" border="0" id="icon_$item.companyId" width="$coordHelper.getIconPxSizeWidth()" heigth="$coordHelper.getIconPxSizeHeigth()" onmouseover="return setImage('info', 'highlite', this.name);" onmouseout="return setImage('info', 'normal', this.name);" alt="$item.getCompanyName()" onclick="location.href='$baseURL&amp;companyId=$item.companyId'" style="POSITION: absolute; TOP: $mappoint.getPxY()px; LEFT: $mappoint.getPxX()px; Z-INDEX: 100; CURSOR: pointer; VISIBILITY: visible"/>                                                
                                                    #end
                                                #end
                                        </div>
                                    </td>
                                    <td width="8px"><a href="javascript:pan('e');"><img src="../images/mapicon/panE.jpg" width="8px" alt="panorer"/></a></td>
                                </tr>
                                <tr>
                                    <td width="8px" height="8px"><a href="javascript:pan('sw');"><img src="../images/mapicon/panSW.jpg" width="8px" height="8px" alt="panorer"/></a></td>
                                    <td align="center" height="8px" width="$coordHelper.getImgWidth()px"><a href="javascript:pan('s');"><img src="../images/mapicon/panS.jpg" height="8px" alt="panorer"/></a></td>
                                    <td width="8px" height="8px"><a href="javascript:pan('se');"><img src="../images/mapicon/panSE.jpg" width="8px" height="8px" alt="panorer"/></a></td>
                    		</tr>                                
                                <tr>
                                    <td colspan="3" height="5">&nbsp</td>
                                </tr>
                                <tr>
                                    <td colspan="3" align="center" valign="center">
                                        <a href="javascript:zoomin('uselevel');"><img src="../images/mapicon/zoomin_1.gif" height="25" width="25" alt="Zoom inn"/></a>
                                        <img src="" name="zoombar" height="43" width="166" alt="Zoom bar" usemap="#zoombarmap" border="0"/>                                                                                                                   
                                        <a href="javascript:zoomout('uselevel');"><img src="../images/mapicon/zoomout_1.gif" height="25" width="25" alt="Zoom ut"/></a>                                        
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3" height="5">&nbsp</td>
                                </tr>
                            </table>                            
                        </td>
                        ## ---------------- kart del -------------------

                    </tr>
                </table>
            #else
                <div id="no_hits">
                    #parse("no-hits.vm")
                    <p>
                        Er du usikker på bransjebetegnelser? <a href="#">Velg bransje her</a><br />
                        <a href="#">Se eksempel på søkeord</a>
                    </p>
                </div>
            #end

             <script type="text/javascript" language="JavaScript">   
                init();
             </script>
             <map id="zoombar_1" name="zoombarmap">
                <area shape="rect"# "Målestokkniv&aring; 1"
                 coords="5,3,32,38" href="javascript:zoomlevel(1);" title="&#34;Zoom til målestokkniv&aring; 1&#34;" />
                <area shape="rect"#"Målestokkniv&aring; 2"
                 coords="32,4,50,37" href="javascript:zoomlevel(2);" title="&#34;Zoom til målestokkniv&aring; 2&#34;" />
                <area shape="rect"#"Målestokkniv&aring; 3"
                 coords="52,4,68,37" href="javascript: zoomlevel(3);" title="&#34;Zoom til målestokkniv&aring; 3&#34;" />
                <area shape="rect"#"Målestokkniv&aring; 4"
                 coords="70,5,90,38" href="javascript: zoomlevel(4);" title="&#34;Zoom til målestokkniv&aring; 4&#34;" />
                <area shape="rect"#"Målestokkniv&aring; 5"
                 coords="91,5,114,37" href="javascript:zoomlevel(5);" title="&#34;Zoom til målestokkniv&aring; 5&#34;" />
                <area shape="rect"#"Målestokkniv&aring; 6"
                 coords="115,5,135,37" href="javascript:zoomlevel(6);" title="&#34;Zoom til målestokkniv&aring; 6&#34;" />
                <area shape="rect"#"Målestokkniv&aring; 7"
                 coords="136,5,166,37" href="javascript:zoomlevel(7);" title="&#34;Zoom til målestokkniv&aring; 7&#34;" />
              </map>       
        </content>


        <content tag="more-results-y">

            #set ($tab = "y")
            #if ($result.getModifier())
                #set ($extra = "&amp;mod=$result.getModifier()")
            #end
            #parse("verbosePager.vm")

        </content>

    </body>
</html>